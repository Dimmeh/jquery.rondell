jQuery.rondell={version:"0.7",name:"rondell",layer_count:0,current_layer:1,radius:{x:300,y:300},center:{left:400,top:350},size:{width:undefined,height:undefined},visible_items:"auto",scaling:2,opacity_min:0.1,fade_time:300,item_delay:100,item_class:"rondell_item",resizeable_class:"resizeable",small_class:"item_small",hidden_class:"item_hidden",item_size:{width:150,height:150},item_size_focus:{width:0,height:0},item_top_margin:20,items:[],repeating:true,auto_rotation:false,auto_rotation_paused:false,auto_rotation_timer:-1,auto_rotation_direction:0,auto_rotation_once:false,auto_rotation_delay:5000,controls_enabled:true,controls_fade_time:500,controls_margin:{x:20,y:20},strings:{prev:"prev",next:"next"},func_left:function(a,b){return b.center.left-b.item_size.width/2+Math.sin(a)*b.radius.x},func_top:function(a,b){return b.center.top-b.item_size.height/2+Math.cos(a)*b.radius.y},func_diff:function(a,b){return Math.pow(Math.abs(a)/b.layer_count,0.5)*Math.PI},func_ease:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f+a}return -h/2*((--f)*(f-2)-1)+a},func_opacity:function(a,b){return b.opacity_min+(1-b.opacity_min)*(1-Math.pow(a/b.visible_items,2))},show_caption:function(b,a){a.items[a.current_layer].object.find(".rondell_caption").stop().fadeTo(300,1)},hide_captions:function(a){$(".rondell_caption").stop().fadeTo(200,0)},event:{layer_fadein:function(c,a){var b=a.items[c];b.small=false;b.object.animate({width:b.size_focus.width+"px",height:b.size_focus.height+"px",left:a.center.left-b.size_focus.width/2+"px",top:a.center.top-b.size_focus.height/2+"px",opacity:"1.0"},a.fade_time,a.func_ease,a.event.auto_shift(a)).css("z-index",6000).addClass("rondell_item_focused");if(b.icon&&!b.resizeable){b.icon.animate({marginTop:a.item_top_margin+(a.item_size.height-b.icon.height())/2+"px"},a.fade_time)}},layer_fadeout:function(f,c){var d=c.items[f];var b=Math.abs(f-c.current_layer);if(b>c.visible_items&&c.repeating){if(c.current_layer+c.visible_items>c.layer_count){f+=c.layer_count}else{if(c.current_layer-c.visible_items<=c.layer_count){f-=c.layer_count}}b=Math.abs(f-c.current_layer)}var a=c.func_diff(f-c.current_layer,c);if(f<c.current_layer){a*=-1}if(b<=c.visible_items){d.object.animate({width:d.size_small.width+"px",height:d.size_small.height+"px",left:c.func_left(a,c)+(c.item_size.width-d.size_small.width)/2+"px",top:c.func_top(a,c)+(c.item_size.height-d.size_small.height)/2+"px",opacity:c.opacity_min!=1?c.func_opacity(b,c):1},c.fade_time+c.item_delay*b,c.func_ease);if(d.hidden){d.hidden=false}if(!d.small){d.small=true;if(!d.resizeable){var e=(c.item_size.height-d.icon.height())/2+"px";d.icon.animate({marginTop:e,marginBottom:e},c.fade_time)}}d.object.css("z-index",a<0?5000+f:5000-f).removeClass("rondell_item_focused")}else{if(!d.hidden){d.hidden=true;d.object.fadeTo(c.fade_time/2+c.item_delay*b,0)}}},shift_to:function(c,a){if((c>0&&c<=a.layer_count)||a.repeating){if(c<1){c=a.layer_count}else{if(c>a.layer_count){c=1}}a.current_layer=c;for(var b=1;b<=a.layer_count;b++){if(b!=a.current_layer){a.event.layer_fadeout(b,a)}}a.event.layer_fadein(a.current_layer,a)}a.hide_captions(a);if(a.hovering){a.show_caption(a.current_layer,a)}},shift_left:function(a){a.event.shift_to(a.current_layer-1,a);a.hide_captions(a);if(a.hovering){a.show_caption(a.current_layer,a)}},shift_right:function(a){a.event.shift_to(a.current_layer+1,a);a.hide_captions(a);if(a.hovering){a.show_caption(a.current_layer,a)}},auto_shift:function(a){if(a.auto_rotation&&a.auto_rotation_timer==-1){a.auto_rotation_timer=window.setTimeout(function(){a.auto_rotation_timer=-1;if(!a.auto_rotation_paused){if(a.auto_rotation_direction==0){a.event.shift_left(a)}else{a.event.shift_right(a)}}},a.auto_rotation_delay)}},key_down:function(b,a){switch(b){case 37:a.event.shift_left(a);break;case 39:a.event.shift_right(a)}}}};jQuery.fn.rondell=function(d){d=jQuery.extend(jQuery.rondell,d||{});d.size.width=d.size.width||(d.center.left+1.5*d.item_size.width+d.radius.x/2);d.size.height=d.size.height||(d.center.top+d.item_size.height+d.radius.y/2);this.each(function(){var k=jQuery(this);d.layer_count+=1;var p=d.layer_count;var o=k.find("img:first");var j=o.hasClass(d.resizeable_class);var n=o.width();var m=o.height();var i=n;var l=m;if(j){if(n>=m){m*=d.item_size.width/n;l*=d.item_size_focus.width/i;n=d.item_size.width;i=d.item_size_focus.width}else{n*=d.item_size.height/m;i*=d.item_size_focus.height/l;m=d.item_size.height;l=d.item_size_focus.height}}else{n=d.item_size.width;m=d.item_size.height;i=d.item_size_focus.width>0?d.item_size_focus.width:n*d.scaling;l=d.item_size_focus.height>0?d.item_size_focus.height:m*d.scaling}d.items[p]={object:k,icon:o,small:false,hidden:false,resizeable:j,size_small:{width:n,height:m},size_focus:{width:i,height:l}};var q=o.length?o.siblings():k.children();if(q.length){q.wrapAll('<div class="rondell_caption"></div>');if(o.length){k.append(q.parent().remove());k.find(".rondell_caption").addClass("overlay")}}k.addClass(d.item_class).click(function(){if(d.current_layer!=p){d.event.shift_to(p,d);return false}})});this.wrapAll('<div class="rondell_container"></div>');var a=this.parent();a.css({overflow:"hidden",width:d.size.width,display:"block",position:"relative",height:d.size.height});a.hover(function(){d.hovering=true;if(!d.auto_rotation_paused){d.auto_rotation_paused=true}d.show_caption(d.current_layer,d)},function(){d.hovering=false;if(d.auto_rotation_paused&&!d.auto_rotation_once){d.auto_rotation_paused=false;d.event.auto_shift(d)}d.hide_captions(d)});if(d.controls_enabled){var b=jQuery('<div class="rondell_controls"><a href="/" class="rondell_control rondell_shift_left">'+d.strings.prev+'</a><a href="/" class="rondell_control rondell_shift_right">'+d.strings.next+"</a></div>");a.append(b);a.hover(function(){b.find(".rondell_control").stop().fadeTo(d.controls_fade_time,1)},function(){b.find(".rondell_control").stop().fadeTo(d.controls_fade_time,0)});b.children().fadeTo(0,0);var h=b.find(".rondell_shift_left");var g=b.find(".rondell_shift_right");var f=d.item_size_focus.width>0?d.item_size_focus.width:d.item_size.width*d.scaling;var c=d.item_size_focus.height>0?d.item_size_focus.height:d.item_size.height*d.scaling;b.css({left:d.controls_margin.x,top:d.controls_margin.y,width:d.size.width-d.controls_margin.x*2});h.click(function(){d.event.shift_left(d);return false});g.click(function(){d.event.shift_right(d);return false})}jQuery(document).keydown(function(i){d.event.key_down(i.which,d)});if(d.visible_items=="auto"){d.visible_items=d.current_layer}for(var e=1;e<=d.layer_count;e++){d.event.layer_fadeout(e,d)}d.event.layer_fadein(d.current_layer,d);a.children().css("visibility","visible");return jQuery(this)};
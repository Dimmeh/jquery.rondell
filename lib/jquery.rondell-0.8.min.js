/*!
  jQuery rondell plugin
  @name jquery.rondell.js
  @author Sebastian Helzle (sebastian@helzle.net or @sebobo)
  @version 0.8
  @date 10/28/2011
  @category jQuery plugin
  @copyright (c) 2009-2011 Sebastian Helzle (www.sebastianhelzle.net)
  @license Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
*/
var __bind=function(a,b){return function(){return a.apply(b,arguments)}};(function(a){var b;a.rondell={version:"0.8",name:"rondell",defaults:{resizeableClass:"resizeable",smallClass:"itemSmall",hiddenClass:"itemHidden",itemCount:0,currentLayer:1,container:null,controlsContainer:null,radius:{x:300,y:300},center:{left:400,top:350},size:{width:null,height:null},visibleItems:"auto",scaling:2,opacityMin:0.01,fadeTime:300,zIndex:1000,itemProperties:{delay:100,cssClass:"rondellItem",size:{width:150,height:150},sizeFocused:{width:0,height:0},topMargin:20},repeating:true,autoRotation:{enabled:false,paused:false,timer:-1,direction:0,once:false,delay:5000},controls:{enabled:true,fadeTime:400,margin:{x:20,y:20}},strings:{prev:"prev",next:"next"},funcEase:"easeInOutQuad"}};if(!a.easing.easeInOutQuad){a.easing.easeInOutQuad=function(f,g,e,i,h){if((g/=h/2)<1){return i/2*g*g+e}else{return -i/2*((--g)*(g-2)-1)+e}}}b=(function(){c.rondellCount=0;c.activeRondell=null;function c(d){this.keyDown=__bind(this.keyDown,this);this._autoShift=__bind(this._autoShift,this);this.shiftRight=__bind(this.shiftRight,this);this.shiftLeft=__bind(this.shiftLeft,this);this.shiftTo=__bind(this.shiftTo,this);this.layerFadeOut=__bind(this.layerFadeOut,this);this.layerFadeIn=__bind(this.layerFadeIn,this);this._hover=__bind(this._hover,this);this._start=__bind(this._start,this);this._initItem=__bind(this._initItem,this);this._getItem=__bind(this._getItem,this);this.hideCaption=__bind(this.hideCaption,this);this.showCaption=__bind(this.showCaption,this);this.id=c.rondellCount++;this.items=[];a.extend(true,this,a.rondell.defaults,d||{})}c.prototype.funcLeft=function(e,d){return d.center.left-d.itemProperties.size.width/2+Math.sin(e)*d.radius.x};c.prototype.funcTop=function(e,d){return d.center.top-d.itemProperties.size.height/2+Math.cos(e)*d.radius.y};c.prototype.funcDiff=function(e,d){return Math.pow(Math.abs(e)/d.itemCount,0.5)*Math.PI};c.prototype.funcOpacity=function(e,d){return d.opacityMin+(1-d.opacityMin)*(1-Math.pow(e/d.visibleItems,2))};c.prototype.showCaption=function(d){return a(".rondellCaption.overlay",this._getItem(d).object).css({height:"auto",overflow:"auto"}).stop(true).fadeTo(300,1)};c.prototype.hideCaption=function(e){var d;d=a(".rondellCaption.overlay:visible",this._getItem(e).object);return d.css({height:d.height(),overflow:"hidden"}).stop(true).fadeTo(100,0)};c.prototype._getItem=function(d){return this.items[d-1]};c.prototype._initItem=function(e,g){var d,f,h;this.items[e-1]=g;f=((h=g.icon)!=null?h.siblings():void 0)||g.object.children();if(f.length){d=a('<div class="rondellCaption"></div>');if(g.icon){d.addClass("overlay")}f.wrapAll(d)}return g.object.addClass(this.itemProperties.cssClass).click(__bind(function(i){if(this.currentLayer!==e){this.shiftTo(e);return i.preventDefault()}},this))};c.prototype._start=function(){var d;if(this.visibleItems==="auto"){this.visibleItems=this.currentLayer}d=this.controls;if(d.enabled){this.controlsContainer=a('<div class="rondellControls"></div>').append(a('<a href="#"/>').addClass("rondellShiftLeft").text(this.strings.prev).click(this.shiftLeft)).append(a('<a href="#/"/>').addClass("rondellShiftRight").text(this.strings.next).click(this.shiftRight)).css({"padding-left":d.margin.x,"padding-right":d.margin.x,left:0,right:0,top:d.margin.y,"z-index":this.zIndex+this.itemCount+2});this.container.append(this.controlsContainer)}a(document).keydown(this.keyDown);this.container.bind("mouseover mouseout",this._hover);return this.shiftTo(this.currentLayer)};c.prototype._hover=function(f){var d;if(this.controlsContainer){a("a",this.controlsContainer).stop().fadeTo(this.controls.fadeTime,f.type==="mouseover"?1:0)}d=this.autoRotation.paused;if(f.type==="mouseover"){c.activeRondell=this.id;this.hovering=true;if(!d){this.autoRotation.paused=true;return this.showCaption(this.currentLayer)}}else{this.hovering=false;if(d&&!this.autoRotation.once){this.autoRotation.paused=false;this._autoShift()}return this.hideCaption(this.currentLayer)}};c.prototype.layerFadeIn=function(f){var g,d,e;g=this._getItem(f);g.small=false;e=g.sizeFocused.width;d=g.sizeFocused.height;g.object.animate({width:e,height:d,left:this.center.left-e/2,top:this.center.top-d/2,opacity:1},this.fadeTime,this.funcEase,__bind(function(){this._autoShift();if(this.hovering){return this.showCaption(f)}},this)).css("z-index",this.zIndex+this.itemCount).addClass("rondellItemFocused");if(g.icon&&!g.resizeable){return g.icon.animate({marginTop:this.itemTopMargin+(this.itemProperties.size.height-g.icon.height())/2},this.fadeTime)}};c.prototype.layerFadeOut=function(e){var f,h,i,d,g;f=this._getItem(e);i=Math.abs(e-this.currentLayer);d=e;if(i>this.visibleItems&&this.repeating){if(this.currentLayer+this.visibleItems>this.itemCount){d+=this.itemCount}else{if(this.currentLayer-this.visibleItems<=this.itemCount){d-=this.itemCount}}i=Math.abs(d-this.currentLayer)}h=this.funcDiff(d-this.currentLayer,this);if(d<this.currentLayer){h*=-1}if(i<=this.visibleItems){this.hideCaption(e);f.object.animate({width:f.sizeSmall.width,height:f.sizeSmall.height,left:this.funcLeft(h,this)+(this.itemProperties.size.width-f.sizeSmall.width)/2,top:this.funcTop(h,this)+(this.itemProperties.size.height-f.sizeSmall.height)/2,opacity:this.opacityMin!==1?this.funcOpacity(i,this):1},this.fadeTime+this.itemProperties.delay*i,this.funcEase);f.hidden=false;if(!f.small){f.small=true;if(f.icon&&!f.resizeable){g=(this.itemProperties.size.height-f.icon.height())/2;f.icon.animate({marginTop:g,marginBottom:g},this.fadeTime)}}return f.object.css("z-index",h<0?this.zIndex+d:this.zIndex-d).removeClass("rondellItemFocused")}else{if(!f.hidden){f.hidden=true;return f.object.fadeTo(this.fadeTime/2+this.itemProperties.delay*i,0,__bind(function(){return this.hideCaption(e)},this))}}};c.prototype.shiftTo=function(f){var d,e,g;g=this.itemCount;if(this.repeating){if(f<1){f=g}else{if(f>g){f=1}}}if(f>0&&f<=g){this.currentLayer=d=f;for(e=1;1<=g?e<=g:e>=g;1<=g?e++:e--){if(e!==d){this.layerFadeOut(e)}}return this.layerFadeIn(d)}};c.prototype.shiftLeft=function(d){if(d){d.preventDefault()}return this.shiftTo(this.currentLayer-1)};c.prototype.shiftRight=function(d){if(d){d.preventDefault()}return this.shiftTo(this.currentLayer+1)};c.prototype._autoShift=function(){var d;d=this.autoRotation;if(this.isActive()&&d.enabled&&d.timer<0){return d.timer=window.setTimeout(__bind(function(){this.autoRotation.timer=-1;if(this.isActive()&&!d.paused){if(d.direction){return this.shiftRight()}else{return this.shiftLeft()}}},this),d.delay)}};c.prototype.isActive=function(){return true};c.prototype.keyDown=function(d){if(this.isActive()&&c.activeRondell===this.id){if(this.autoRotation.timer>=0){window.clearTimeout(this.autoRotation.timer);this.autoRotation.timer=-1}switch(d.which){case 37:return this.shiftLeft(d);case 39:return this.shiftRight(d)}}};return c})();return a.fn.rondell=function(p){var c,d,o,m,j,g,f,i,l,h,k,n,e;n=new b(p);i=n.itemProperties;l=i.size.width;f=i.size.height;e=n.scaling;c=n.center;k=n.radius;m=n.size.width|=c.left*2;o=n.size.height|=c.top*2;g=i.sizeFocused.width||l*e;j=i.sizeFocused.height||f*e;h=this.length;this.wrapAll(a('<div class="rondellContainer"></div>'));d=n.container=this.parent().css({width:m,height:o});this.each(function(){var q,r,s;r=a(this);s=a("img:first",r);if(s.length){return s.load(function(){var x,t,w,v,u,z,y;w=a(this);v=w.hasClass(n.resizeableClass);u=n.itemCount+=1;t=y=w.width();x=z=w.height();if(v){if(y>=z){z*=l/y;x*=g/t;y=l;t=g}else{y*=f/z;t*=j/x;z=f;x=j}}else{y=l;z=f;t=g;x=j}n._initItem(u,{object:r,icon:w,small:false,hidden:false,resizeable:v,sizeSmall:{width:y,height:z},sizeFocused:{width:t,height:x}});if(n.itemCount===h){return n._start()}})}else{q=n.itemCount+=1;n._initItem(q,{object:r,icon:null,small:false,hidden:false,resizeable:false,sizeSmall:{width:l,height:f},sizeFocused:{width:g,height:j}});if(n.items.length===h){return n._start()}}});return a(this)}})(jQuery);
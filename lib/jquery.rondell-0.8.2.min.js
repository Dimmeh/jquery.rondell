/*!
  jQuery rondell plugin
  @name jquery.rondell.js
  @author Sebastian Helzle (sebastian@helzle.net or @sebobo)
  @version 0.8.2
  @date 11/19/2011
  @category jQuery plugin
  @copyright (c) 2009-2011 Sebastian Helzle (www.sebastianhelzle.net)
  @license Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
*/
var __bind=function(a,b){return function(){return a.apply(b,arguments)}};(function(a){var b;a.rondell={version:"0.8.2",name:"rondell",defaults:{resizeableClass:"resizeable",smallClass:"itemSmall",hiddenClass:"itemHidden",itemCount:0,currentLayer:1,container:null,radius:{x:300,y:50},center:{left:400,top:200},size:{width:null,height:null},visibleItems:"auto",scaling:2,opacityMin:0.05,fadeTime:300,zIndex:1000,itemProperties:{delay:100,cssClass:"rondellItem",size:{width:150,height:150},sizeFocused:{width:0,height:0},topMargin:20},repeating:true,autoRotation:{enabled:false,paused:false,timer:-1,direction:0,once:false,delay:5000},controls:{enabled:true,fadeTime:400,margin:{x:20,y:20}},strings:{prev:"prev",next:"next"},touch:{enabled:true,preventDefaults:true,threshold:100,start:void 0,end:void 0},funcEase:"easeInOutQuad"}};if(!a.easing.easeInOutQuad){a.easing.easeInOutQuad=function(f,g,e,i,h){if((g/=h/2)<1){return i/2*g*g+e}else{return -i/2*((--g)*(g-2)-1)+e}}}b=(function(){c.rondellCount=0;c.activeRondell=null;function c(d,e){this.keyDown=__bind(this.keyDown,this);this._autoShift=__bind(this._autoShift,this);this.shiftRight=__bind(this.shiftRight,this);this.shiftLeft=__bind(this.shiftLeft,this);this.shiftTo=__bind(this.shiftTo,this);this.layerFadeOut=__bind(this.layerFadeOut,this);this.layerFadeIn=__bind(this.layerFadeIn,this);this._hover=__bind(this._hover,this);this._touch=__bind(this._touch,this);this._start=__bind(this._start,this);this._loadItem=__bind(this._loadItem,this);this._onloadItem=__bind(this._onloadItem,this);this._initItem=__bind(this._initItem,this);this._getItem=__bind(this._getItem,this);this.hideCaption=__bind(this.hideCaption,this);this.showCaption=__bind(this.showCaption,this);this.id=c.rondellCount++;this.items=[];this.maxItems=e;a.extend(true,this,a.rondell.defaults,d||{});this.itemProperties.sizeFocused={width:this.itemProperties.sizeFocused.width||this.itemProperties.size.width*this.scaling,height:this.itemProperties.sizeFocused.height||this.itemProperties.size.height*this.scaling};this.size={width:this.size.width||this.center.left*2,height:this.size.height||this.center.top*2}}c.prototype.funcLeft=function(e,d){return d.center.left-d.itemProperties.size.width/2+Math.sin(e)*d.radius.x};c.prototype.funcTop=function(e,d){return d.center.top-d.itemProperties.size.height/2+Math.cos(e)*d.radius.y};c.prototype.funcDiff=function(e,d){return Math.pow(Math.abs(e)/d.itemCount,0.5)*Math.PI};c.prototype.funcOpacity=function(e,d){if(d.visibleItems>1){return Math.max(0,1-Math.pow(e/d.visibleItems,2))}else{return 0}};c.prototype.showCaption=function(d){return a(".rondellCaption.overlay",this._getItem(d).object).css({height:"auto",overflow:"auto"}).stop(true).fadeTo(300,1)};c.prototype.hideCaption=function(e){var d;d=a(".rondellCaption.overlay:visible",this._getItem(e).object);return d.css({height:d.height(),overflow:"hidden"}).stop(true).fadeTo(200,0)};c.prototype._getItem=function(d){return this.items[d-1]};c.prototype._initItem=function(f,h){var d,e,g,i,k,j;this.items[f-1]=h;g=(i=h.icon)!=null?i.siblings():void 0;if(!((g!=null?g.length:void 0)||h.icon)&&h.object.children().length){g=h.object.children()}if(!g.length){d=h.object.attr("title")||((k=h.icon)!=null?k.attr("alt"):void 0)||((j=h.icon)!=null?j.attr("title"):void 0);if(d){g=a("<p>"+d+"</p>");h.object.append(g)}}if(g.length){e=a('<div class="rondellCaption"></div>');if(h.icon){e.addClass("overlay")}g.wrapAll(e)}h.object.addClass("rondellItemNew "+this.itemProperties.cssClass).css({opacity:0,width:h.sizeSmall.width,height:h.sizeSmall.height,left:this.center.left-h.sizeFocused.width/2,top:this.center.top-h.sizeFocused.height/2}).bind("mouseover mouseout click",__bind(function(l){switch(l.type){case"mouseover":if(h.object.is(":visible")&&!h.hidden){return h.object.addClass("rondellItemHovered")}break;case"mouseout":return h.object.removeClass("rondellItemHovered");case"click":if(h.object.is(":visible")&&!(this.currentLayer===f||h.hidden)){this.shiftTo(f);return l.preventDefault()}}},this));if(this.itemCount===this.maxItems){return this._start()}};c.prototype._onloadItem=function(i,d){var n,g,m,k,f,o,h,e,j,l;if(d==null){d=void 0}k=a("img:first",i);f=k.hasClass(this.resizeableClass);h=this.itemCount+=1;o=this.itemProperties.size;m=this.itemProperties.sizeFocused;e=this.scaling;g=l=(d!=null?d.width():void 0)||(d!=null?d[0].width:void 0)||k[0].width||k.width();n=j=(d!=null?d.height():void 0)||(d!=null?d[0].height:void 0)||k[0].height||k.height();if(d!=null){d.remove()}if(!(l&&j)){return}if(f){if(l>=j){j*=o.width/l;n*=m.width/g;l=o.width;g=m.width}else{l*=o.height/j;g*=m.height/n;j=o.height;n=m.height}}else{l=o.width;j=o.height;g=m.width;n=m.height}return this._initItem(h,{object:i,icon:k,small:false,hidden:false,resizeable:f,sizeSmall:{width:l,height:j},sizeFocused:{width:g,height:n}})};c.prototype._loadItem=function(e){var f,d;d=a("img:first",e);if(d[0].complete&&d[0].width){return this._onloadItem(e)}else{f=a('<img style="display:none"/>');a("body").append(f);return f.one("load",__bind(function(){return this._onloadItem(e,f)},this)).attr("src",d.attr("src"))}};c.prototype._start=function(){var e,f,d;this.currentLayer=Math.round(this.itemCount/2);if(this.visibleItems==="auto"){this.visibleItems=Math.max(2,Math.floor(this.itemCount/2))}e=this.controls;if(e.enabled){f=a('<a class="rondellControl rondellShiftLeft" href="#"/>').text(this.strings.prev).click(this.shiftLeft).css({left:e.margin.x,top:e.margin.y,"z-index":this.zIndex+this.itemCount+2});d=a('<a class="rondellControl rondellShiftRight" href="#/"/>').text(this.strings.next).click(this.shiftRight).css({right:e.margin.x,top:e.margin.y,"z-index":this.zIndex+this.itemCount+2});this.container.append(f,d)}a(document).keydown(this.keyDown);this.container.removeClass("initializing").bind("mouseover mouseout",this._hover).bind("touchstart touchmove touchend",this._touch);return this.shiftTo(this.currentLayer)};c.prototype._touch=function(d){var g,f;if(!this.touch.enabled){return}f=d.originalEvent.touches[0]||d.originalEvent.changedTouches[0];switch(d.type){case"touchstart":this.touch.start={x:f.pageX,y:f.pageY};break;case"touchmove":if(this.touch.preventDefaults){d.preventDefault()}this.touch.end={x:f.pageX,y:f.pageY};break;case"touchend":if(this.touch.start&&this.touch.end){g=this.touch.end.x-this.touch.start.x;if(Math.abs(g)>this.touch.threshold){if(g>0){this.shiftLeft()}if(g<0){this.shiftRight()}}this.touch.start=this.touch.end=void 0}}return true};c.prototype._hover=function(f){var d;a(".rondellControl",this.container).stop().fadeTo(this.controls.fadeTime,f.type==="mouseover"?1:0);d=this.autoRotation.paused;if(f.type==="mouseover"){c.activeRondell=this.id;this.hovering=true;if(!d){this.autoRotation.paused=true;return this.showCaption(this.currentLayer)}}else{this.hovering=false;if(d&&!this.autoRotation.once){this.autoRotation.paused=false;this._autoShift()}return this.hideCaption(this.currentLayer)}};c.prototype.layerFadeIn=function(f){var g,d,e,h;g=this._getItem(f);g.small=false;e=g.sizeFocused.width;d=g.sizeFocused.height;g.object.stop(true).show(0).css("z-index",this.zIndex+this.itemCount).addClass("rondellItemFocused").animate({width:e,height:d,left:this.center.left-e/2,top:this.center.top-d/2,opacity:1},this.fadeTime,this.funcEase,__bind(function(){this._autoShift();if(this.hovering){return this.showCaption(f)}},this));if(g.icon&&!g.resizeable){h=(this.itemProperties.size.height-g.icon.height())/2;return g.icon.stop(true).animate({marginTop:h,marginBottom:h},this.fadeTime)}};c.prototype.layerFadeOut=function(h){var l,i,n,f,e,k,g,j,d,o,m;n=this._getItem(h);e=Math.abs(h-this.currentLayer);k=h;if(e>this.visibleItems&&this.repeating){if(this.currentLayer+this.visibleItems>this.itemCount){k+=this.itemCount}else{if(this.currentLayer-this.visibleItems<=this.itemCount){k-=this.itemCount}}e=Math.abs(k-this.currentLayer)}f=this.funcDiff(k-this.currentLayer,this);if(k<this.currentLayer){f*=-1}d=this.funcLeft(f,this)+(this.itemProperties.size.width-n.sizeSmall.width)/2;o=this.funcTop(f,this)+(this.itemProperties.size.height-n.sizeSmall.height)/2;m=this.zIndex+(f<0?k:-k);l=this.fadeTime+this.itemProperties.delay*e;i=n.object.hasClass("rondellItemNew");if(i||e<=this.visibleItems){this.hideCaption(h);j=this.funcOpacity(e,this);if(j>=this.opacityMin){n.object.show()}n.object.removeClass("rondellItemNew rondellItemFocused").stop(true).css("z-index",m).animate({width:n.sizeSmall.width,height:n.sizeSmall.height,left:d,top:o,opacity:j},l,this.funcEase,__bind(function(){if(n.object.css("opacity")<this.opacityMin){return n.object.hide()}else{return n.object.show()}},this));n.hidden=false;if(!n.small){n.small=true;if(n.icon&&!n.resizeable){g=(this.itemProperties.size.height-n.icon.height())/2;return n.icon.stop(true).animate({marginTop:g,marginBottom:g},l)}}}else{if(n.hidden){return n.object.css({left:d,top:o,"z-index":m})}else{n.hidden=true;return n.object.stop(true).css("z-index",m).animate({opacity:0},l/2,this.funcEase,__bind(function(){},this),this.hideCaption(h))}}};c.prototype.shiftTo=function(f){var d,e,g;g=this.itemCount;if(this.repeating){if(f<1){f=g}else{if(f>g){f=1}}}if(f>0&&f<=g){this.currentLayer=d=f;for(e=1;1<=g?e<=g:e>=g;1<=g?e++:e--){if(e!==d){this.layerFadeOut(e)}}return this.layerFadeIn(d)}};c.prototype.shiftLeft=function(d){if(d!=null){d.preventDefault()}return this.shiftTo(this.currentLayer-1)};c.prototype.shiftRight=function(d){if(d!=null){d.preventDefault()}return this.shiftTo(this.currentLayer+1)};c.prototype._autoShift=function(){var d;d=this.autoRotation;if(this.isActive()&&d.enabled&&d.timer<0){return d.timer=window.setTimeout(__bind(function(){this.autoRotation.timer=-1;if(this.isActive()&&!d.paused){if(d.direction){return this.shiftRight()}else{return this.shiftLeft()}}},this),d.delay)}};c.prototype.isActive=function(){return true};c.prototype.keyDown=function(d){if(this.isActive()&&c.activeRondell===this.id){if(this.autoRotation.timer>=0){window.clearTimeout(this.autoRotation.timer);this.autoRotation.timer=-1}switch(d.which){case 37:return this.shiftLeft(d);case 39:return this.shiftRight(d)}}};return c})();return a.fn.rondell=function(d){var c;c=new b(d,this.length);this.wrapAll(a('<div class="rondellContainer initializing"></div>'));c.container=this.parent().css(c.size);this.each(function(){var e,f;f=a(this);if(a("img:first",f).length){return c._loadItem(f)}else{e=c.itemCount+=1;return c._initItem(e,{object:f,icon:null,small:false,hidden:false,resizeable:false,sizeSmall:c.itemProperties.size,sizeFocused:c.itemProperties.sizeFocused})}});return c}})(jQuery);